import{a1 as e,a2 as t,f as a,i as s,m as l,r as o,o as n,c,a as r,z as d,v as i,P as u,y as m,H as p,N as f,R as v,F as h,K as y,J as _,a3 as I,d as g,p as w}from"./vendor.e8c09140.js";import{Q as b,b as x,u as C}from"./index.f15bb496.js";import{r as $,h as T}from"./toolFun.ddcca621.js";const E={name:"commentItem",props:{data:{type:Object}},components:{},setup(e,t){const{proxy:o}=_(),n=x();let c=e.data,r=a(!1),d=s("success");var i=o;l((()=>{document.addEventListener("click",(e=>{1==r.value&&(i.$refs.input.contains(e.target)||(r.value=!1))}))}));let u=a("");return{item:c,replay:u,show:r,upComment:function(){let e=c._id,t=e;null!=c.follow&&(t=c.follow),o.$axios.post("addComment",{articleId:c.articleId,content:u.value,user:n.state.userInfo._id,commentId:e,follow:t}).then((e=>{200==e.code&&(u.value="",r.value=!1,d(),b.success({message:e.msg}))}))}}}},V=I("data-v-e58e7c60");e("data-v-e58e7c60");const k={class:"header"},K={class:"right"},j={key:0,class:"replayCont"},P={class:"bottom_comment"},U={class:"time"},A=r("img",{src:"/assets/comment.ff7f8d59.png",class:"btnIcon",alt:""},null,-1),H=u(" 回复 "),L={class:"replay",ref:"input"},q={class:"children"};t();const F=V(((e,t,a,s,l,_)=>{const I=o("el-input"),g=o("_self");return n(),c("div",null,[r("div",k,[r("img",{class:"userAvator",src:s.item.user.picUrl,alt:"",srcset:""},null,8,["src"]),r("div",K,[r("p",null,d(s.item.user.username),1),r("p",null,[s.item.replay?(n(),c("span",j,d("回复 "+s.item.replay+":"),1)):i("",!0),u(d(s.item.content),1)])])]),r("div",P,[r("div",U,d(s.item.howTime),1),r("div",{class:"huifu",onClick:t[1]||(t[1]=m((e=>s.show=!s.show),["stop"]))},[A,H])]),r("div",L,[p(r(I,{placeholder:"回复"+s.item.user.username+"...",onKeyup:v(s.upComment,["enter"]),modelValue:s.replay,"onUpdate:modelValue":t[2]||(t[2]=e=>s.replay=e)},null,8,["placeholder","onKeyup","modelValue"]),[[f,s.show]])],512),r("div",q,[(n(!0),c(h,null,y(s.item.children,(e=>(n(),c(g,{key:e._id,data:e},null,8,["data"])))),128))])])}));E.render=F,E.__scopeId="data-v-e58e7c60";const M={components:{commentItem:E},setup(){let e=s("_id");const t=x(),l=t.state.userInfo,{proxy:o}=_(),n=a("");let c=g([]);function r(){o.$axios.get(`/getComment?articleId=${e}`).then((e=>{if(200==e.code){e.data.forEach((t=>{if(t.updatedTime=$(t.updatedTime),t.howTime=T(t.updatedTime),null!=t.follow||null!=t.follow){let a=e.data.filter((e=>e._id==t.commentId));t.replay=a[0].user.username}})),e.data.filter((e=>null==e.follow)).forEach((t=>{if(t.children=e.data.filter((e=>e.follow==t._id)),!t.follow){let e=!0;c.forEach((a=>{t._id==a._id&&(e=!1)})),e&&c.push(t)}})),c.forEach((t=>{t.children||(t.children=[]),e.data.forEach((e=>{t._id==e.follow&&t.children.indexOf(e)<0&&t.children.push(e)}))}))}}))}function d(e){r()}return r(),w("success",d),{userInfo:l,comment:n,upComment:function(){o.$axios.post("addComment",{articleId:e,content:n.value,user:t.state.userInfo._id,follow:null}).then((e=>{200==e.code&&(n.value="",b.success({message:e.msg}),r())}))},comments:c,success:d}}},O=I("data-v-636a3d17");e("data-v-636a3d17");const z={class:"commentArticle"},J={class:"comments"};t();const N=O(((e,t,a,s,l,d)=>{const i=o("el-input"),u=o("comment-item");return n(),c("div",null,[r("div",z,[r("img",{class:"userAvator",src:e.$store.state.userInfo.picUrl,alt:"",srcset:""},null,8,["src"]),r(i,{placeholder:"输入评论...",onKeyup:v(s.upComment,["enter"]),modelValue:s.comment,"onUpdate:modelValue":t[1]||(t[1]=e=>s.comment=e)},null,8,["onKeyup","modelValue"])]),r("div",J,[(n(!0),c(h,null,y(s.comments,(e=>(n(),c("div",{key:e._id,class:"comment"},[r(u,{success:s.success,data:e},null,8,["success","data"])])))),128))])])}));M.render=N,M.__scopeId="data-v-636a3d17";const Q={components:{artComment:M},setup(){const e=C(),t=e.query.id,{proxy:a}=_();let s=g({title:"",introduce:"",coverPic:"",content:""});return w("_id",t),e.query.id&&a.$axios.get(`/article/${t}`).then((e=>{200==e.code&&(s.title=e.data.title,s.introduce=e.data.introduce,s.coverPic=e.data.coverImg,s.content=e.data.content)})),{article:s}}},R=I("data-v-6b8b603a");e("data-v-6b8b603a");const B={class:"article"},D={class:"instroduce"};t();const G=R(((e,t,a,s,l,i)=>{const u=o("art-comment");return n(),c("div",B,[r("h2",null,d(s.article.title),1),r("p",D,d(s.article.introduce),1),r("img",{src:s.article.coverPic,alt:"",class:"coverImg"},null,8,["src"]),r("div",{innerHTML:s.article.content},null,8,["innerHTML"]),r(u)])}));Q.render=G,Q.__scopeId="data-v-6b8b603a";export default Q;
